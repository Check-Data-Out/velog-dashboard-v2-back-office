# =============================================================================
# Docker Compose - Stats Refresh Consumer
# =============================================================================
# Local:  docker compose up -d
#         → override.yml 자동 로드 (db + consumer)
#
# Prod:   docker compose -f docker-compose.yaml --env-file .env.prod up -d
#         → base 파일만 사용 (consumer만, override.yml 무시)
# =============================================================================

services:
  stats-refresh-consumer:
    image: stats-refresh-consumer:latest
    build:
      context: .
      dockerfile: Dockerfile.consumer
    container_name: stats-refresh-consumer
    env_file:
      - path: .env
        required: true
    environment:
      # Consumer 전용 settings (debug_toolbar 제외)
      DJANGO_SETTINGS_MODULE: backoffice.settings.consumer
    restart: unless-stopped
    volumes:
      - ./logs:/app/logs
    command: python -m consumer.stats_refresh_consumer
